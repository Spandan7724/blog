---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

const posts = (await getCollection('blog')) as CollectionEntry<'blog'>[];
const published = posts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const base = import.meta.env.BASE_URL;
const basePath = base.endsWith('/') ? base : `${base}/`;

const formatDate = (date: Date) => {
  return date.toISOString().split('T')[0];
};
---

<BaseLayout title="Spandan" description="Technical blog on software engineering.">
  <div class="container">
    <section class="about">
      <h2>About</h2>
      <p>
        Welcome to my blog. I write about software engineering, programming, and technology.
      </p>
    </section>

    <section class="section">
      <h2 class="section-title">Published</h2>
      <div class="post-list">
        {published.map((post) => (
          <a class="post-item" href={`${basePath}posts/${post.slug}/`}>
            <div class="post-meta">{formatDate(post.data.pubDate)}</div>
            <h3 class="post-title">{post.data.title}</h3>
          </a>
        ))}
      </div>
    </section>
  </div>
</BaseLayout>
