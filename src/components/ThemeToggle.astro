---
---

<button class="theme-toggle" data-theme-toggle aria-label="Toggle theme">
  <span class="theme-icon"></span>
</button>

<script>
  function initThemeToggle() {
    const root = document.documentElement;
    const key = 'theme';
    const button = document.querySelector('[data-theme-toggle]');
    const icon = button?.querySelector('.theme-icon');

    const getTheme = () => root.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
    
    const updateIcon = (theme: string) => {
      if (icon) icon.textContent = theme === 'dark' ? '◐' : '◑';
    };

    updateIcon(getTheme());

    button?.addEventListener('click', () => {
      const next = getTheme() === 'dark' ? 'light' : 'dark';
      if (next === 'dark') {
        root.setAttribute('data-theme', 'dark');
      } else {
        root.removeAttribute('data-theme');
      }
      localStorage.setItem(key, next);
      updateIcon(next);
    });
  }

  // Run on initial load
  initThemeToggle();

  // Re-run after view transitions
  document.addEventListener('astro:after-swap', initThemeToggle);
</script>
